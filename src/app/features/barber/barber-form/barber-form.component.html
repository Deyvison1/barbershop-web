<p-card>
  <h2>{{ title }}</h2>

  <form [formGroup]="form">
    <div class="formgrid grid">
      <div class="field col-12 md:col-6">
        <p-floatlabel variant="on">
          <input
            pInputText
            id="nome"
            autocomplete="off"
            formControlName="name"
            [ngClass]="{
              'ng-invalid ng-dirty':
                form.get('name')?.invalid && form.get('name')?.touched
            }"
            fluid
            maxlength="50"
            minlength="3"
          />
          <label for="nome">Nome do Barbeiro</label>
        </p-floatlabel>
        <app-erro [setControl]="form.get('name')"></app-erro>
      </div>

      <div class="field col-12 md:col-6">
        <p-floatlabel class="w-full md:w-56" variant="on">
          <p-select
            formControlName="userId"
            inputId="on_label"
            [options]="users"
            optionValue="id"
            optionLabel="username"
            class="w-full"
            emptyMessage="Nenhum usuario encontrado"
            fuild
          />
          <label for="on_label">Usuarios</label>
        </p-floatlabel>
        <app-erro [setControl]="form.get('userId')"></app-erro>
      </div>
    </div>

    <!-- Botão para adicionar Especialidade -->
    <div class="flex align-items-center justify-content-start mb-2">
      <p-button
        severity="info"
        icon="pi pi-plus"
        size="small"
        label="Adicionar Especialidade"
        (onClick)="addSpecialty()"
      />
    </div>

    <!-- Especialidades -->
    <p-card>
      <div formArrayName="specialties">
        @for (specialty of specialties.controls; track $index) {
        <div class="mb-3 border-round p-3 surface-card">
          <div class="flex justify-content-end mb-2">
            <p-button
              severity="danger"
              icon="pi pi-trash"
              size="small"
              label="Excluir"
              (onClick)="removeSpecialty($index)"
            />
          </div>

          <div class="formgrid grid" [formGroupName]="$index">
            <!-- Nome da Especialidade -->
            <div class="field col-12 md:col-6">
              <p-floatlabel class="w-full md:w-56" variant="on">
                <input
                  pInputText
                  id="specialty_name_{{ $index }}"
                  autocomplete="off"
                  formControlName="name"
                  [ngClass]="{
                    'ng-invalid ng-dirty':
                      specialty.get('name')?.invalid &&
                      specialty.get('name')?.touched
                  }"
                  fluid
                  maxlength="50"
                  minlength="3"
                />
                <label for="specialty_name_{{ $index }}"
                  >Nome da Especialidade</label
                >
              </p-floatlabel>
              <app-erro [setControl]="specialty.get('name')"></app-erro>
            </div>

            <!-- Descrição da Especialidade -->
            <div class="field col-12 md:col-6">
              <p-floatlabel class="w-full md:w-56" variant="on">
                <textarea
                  pSize="small"
                  rows="3"
                  pTextarea
                  id="specialty_desc_{{ $index }}"
                  formControlName="description"
                  style="resize: none"
                  class="h-full"
                  [ngClass]="{
                    'ng-invalid ng-dirty':
                      specialty.get('description')?.invalid &&
                      specialty.get('description')?.touched
                  }"
                  maxlength="255"
                  minlength="10"
                  fluid
                ></textarea>
                <label for="specialty_desc_{{ $index }}"
                  >Descrição da Especialidade</label
                >
              </p-floatlabel>
              <app-erro [setControl]="specialty.get('description')"></app-erro>
            </div>
          </div>
        </div>
        } @empty {
        <p>Nenhuma especialidade adicionada</p>
        }
      </div>
    </p-card>
    <div class="flex flex-row-reverse flex-wrap">
      <div
        class="flex align-items-center justify-content-center w-4rem h-4rem bg-primary font-bold border-round m-2"
      >
        <p-button label="Salvar" (onClick)="save()"/>
      </div>
    </div>
  </form>
</p-card>
