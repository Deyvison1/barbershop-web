<h2>{{title}}</h2>

<form [formGroup]="form">
  <div class="formgrid grid">
    <div class="field col-12 md:col-6">
      <p-floatlabel variant="on">
        <input
          pInputText
          id="nome"
          autocomplete="off"
          formControlName="name"
          [ngClass]="{
            'ng-invalid ng-dirty':
              form.get('name')?.invalid && form.get('name')?.touched
          }"
          fluid
          maxlength="50"
          minlength="3"
        />
        <label for="nome">Nome do corte</label>
      </p-floatlabel>
      <app-erro [setControl]="form.get('name')"></app-erro>
    </div>

    <div class="field col-12 md:col-3">
      <p-floatlabel variant="on">
        <p-inputnumber
          autocomplete="off"
          formControlName="price"
          [ngClass]="{
            'ng-invalid ng-dirty':
              form.get('price')?.invalid && form.get('price')?.touched
          }"
          formControlName="price"
          inputId="currency-us"
          mode="currency"
          currency="BRL"
          locale="pt-BR"
          fluid
        />
        <label for="price">Preço</label>
      </p-floatlabel>
      <app-erro [setControl]="form.get('price')"></app-erro>
    </div>

    <div class="field col-12 md:col-3">
      <p-floatlabel variant="on">
        <input
          pInputText
          id="tempo"
          autocomplete="off"
          formControlName="time"
          [ngClass]="{
            'ng-invalid ng-dirty':
              form.get('time')?.invalid && form.get('time')?.touched
          }"
          fluid
        />
        <label for="tempo">Tempo (min)</label>
      </p-floatlabel>
      <app-erro [setControl]="form.get('time')"></app-erro>
    </div>
  </div>

  <div class="formgrid grid">
    <div class="field col-12 md:col-12">
      <p-floatlabel variant="on">
        <textarea
          pSize="small"
          rows="3"
          pTextarea
          id="over_label"
          cols="30"
          formControlName="description"
          style="resize: none"
          class="h-full"
          [ngClass]="{
            'ng-invalid ng-dirty': form.controls['description'].invalid
          }"
          maxlength="255"
          minlength="10"
          fluid
        ></textarea>
        <label for="description">Descrição</label>
      </p-floatlabel>
      <app-erro [setControl]="form.get('description')"></app-erro>
    </div>
  </div>
  @if(isUpdate) {
  <div class="formgrid grid">
    <div class="field col-4 md:col-4">
      <p-fileupload
        chooseLabel="Escolher arquivo"
        uploadLabel="Upload do corte."
        cancelLabel="Cancelar"
        pSize="small"
        mode="basic"
        chooseIcon="pi pi-upload"
        accept="image/*"
        maxFileSize="1000000"
        chooseLabel="Browse"
        (onSelect)="onFileSelected($event)"
      />
    </div>
    <div class="field col-4 md:col-4">
      <p-floatlabel>
        <p-datepicker
          formControlName="createdDate"
          inputId="createdDate"
          showIcon
          iconDisplay="input"
          fluid
          dateFormat="dd/mm/yy"
          [disabled]="true"
        />
        <label for="createdDate">Data Da Criação</label>
      </p-floatlabel>
    </div>
    <div class="field col-4 md:col-4">
      <p-floatlabel>
        <p-datepicker
          formControlName="lastModifiedDate"
          inputId="lastModifiedDate"
          showIcon
          iconDisplay="input"
          fluid
          dateFormat="dd/mm/yy"
          [disabled]="true"
        />
        <label for="lastModifiedDate">Ultima atualização</label>
      </p-floatlabel>
    </div>
  </div>
  }

  <div class="flex flex-row-reverse flex-wrap">
    <div
      class="flex align-items-center justify-content-center w-4rem h-4rem bg-primary font-bold border-round m-2"
    >
      <p-button label="Salvar" (onClick)="save()" [disabled]="form.invalid" />
    </div>
  </div>
  <p-galleria
    [value]="imagesArray"
    [showThumbnails]="false"
    [showIndicators]="true"
    [showItemNavigatorsOnHover]="true"
    [(activeIndex)]="activeIndex"
    [circular]="true"
    [responsiveOptions]="responsiveOptions"
    [containerStyle]="{ 'max-width': '640px' }"
    [responsiveOptions]="responsiveOptions"
  >
    <ng-template #item let-item let-i="index">
      <div
        class="galery"
        [ngStyle]="{
          border: item?.active ? '3px solid #2196f3' : '1px solid #ccc',
          boxShadow: item?.active ? '0 0 8px rgba(33,150,243,0.5)' : 'none'
        }"
      >
        <img
          [src]="item?.itemImageSrc"
          alt="{{ item?.filename }}"
          class="img"
        />

        <div class="icon-active" (click)="setActiveImage(item)">
          <i
            class="pi"
            [ngClass]="item?.active ? 'pi-check-circle' : 'pi-circle'"
            style="font-size: 1.2rem; color: #2196f3"
          ></i>
        </div>

        <!-- Botão de remover -->
        <div class="btn-remove">
          <p-button
            icon="pi pi-times"
            severity="danger"
            [rounded]="true"
            (onClick)="removeImage(item)"
            [disabled]="item?.active"
          ></p-button>
        </div>
      </div>
    </ng-template>
  </p-galleria>
</form>
